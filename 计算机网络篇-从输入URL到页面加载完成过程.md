---
title: 从输入URL到页面加载完成过程
date: 2018-08-30 15:01:30
tags:
---
# 计算机知识篇
## 从输入 URL 到页面加载完成的过程 

让我们思考一个问题，你在浏览器中输入 : www.baidu.com 的时候，在你按下回车的那一瞬间，发生了什么事情，为什么能够在你按下之后，就能将百度的首页返回？

“ WC，很简单啊，就是发送一个请求然后就获取了呗~”   emmmm，很简洁的答案。那么具体是为什么呢？直到我看了阮一峰的互联网协议入门（一）之后，才明白原因。耐心的小伙伴可以去看一看阮一峰的教程。如果是想简单知道，那么就继续往下看哈~

所谓的网络通信就是交换数据包。电脑A向电脑B发送一个数据包，后者收到了，回复一个数据包，从而实现两台电脑之间的通信。那么发送这个包，需要知道两个地址：

```javascript
    · 对方的MAC地址

    · 对方的IP地址
```
有了这两个地址，数据包才能准确送到接收者手中。但是，MAC地址有局限性，如果两台电脑不在同一个子网络，就无法知道对方的MAC地址，必须通过网关转发。

好了，看到这，就有人想要问了，什么是MAC地址？根据以太网规定，连入网络的所有设备，都必须具有"网卡"接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48个二进制位，通常用12个十六进制数表示。

<img src="https://upload-images.jianshu.io/upload_images/7885162-683a3337d7c5d7b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/500">

什么？你仿佛在逗我，我只知道我自身网卡MAC地址，我怎么知道他的网卡MAC地址？

根据ARP协议，就可以解决这个问题，这里只需要知道，以太网数据包必须知道接收方的MAC地址，然后才能发送

emmmm，那我知道了他的MAC地址，我该怎样才能把数据包准确送到接收方？

答案就是： 以太网采用了一种很"原始"的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。这种方式就叫做 “广播”。

比如：1号计算机向2号计算机发送一个数据包，同一个子网络的3号、4号、5号计算机都会收到这个包。它们读取这个包的"标头"（标头会有接收者的MAC地址），找到接收方的MAC地址，然后与自身的MAC地址相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。

听着有点晕？那我再举个例子：A班的小明向B班的小红表白，但是他只知道她叫小红(MAC独一无二，不存在相同情况)，不知道长相，于是给B班的所有同学都写了一封情书，B班的每位同学都会收到来自小明的信，他们就会读取这封信的接收者名字，和自己的名字比较，如果两者相同，就接受这封信，不同就丢弃。

这时候你又要问了，在同一个子网络可以通过 “广播” 的形式去获得对方的MAC地址，可是如果两台电脑不在同一个子网络，就无法知道对方的MAC地址，该咋办呢？

这时候就必须通过网关转发。

不懂？那我举个例子，三年级的小红要写一封信给四年级的小张，可是不是同一个年级咋办，这时候小红发现，她的室友小A和小张的室友小B是邻居，于是她对小A说 ：“ 喂，我把这信给你，你交给你邻居小B，让他帮忙交给小张 ” 。最终，信交到了小张的手里。这里小A和小B就充当了网关的职责。

扯那么多，我们来个实例讲解一下，到底按下的那一瞬间发生了什么！

我们知道，发送数据包和请求，必须要知道对方的IP地址，可是我们现在只知道域名，不知道对方的IP地址咋办，这时候DNS就发挥作用了。

---------
### 老哥，走一个例子流程
<!--more-->
#### DNS发挥超强作用
当我们在浏览器中输入  :  www.baidu.com 之后，会给DNS服务器发送一个DNS数据包，告诉DNS ： “喂，我要访问www.baidu.com，你把他的IP地址给我”，然后DNS服务器做出响应，告诉我们 ： “ 百度的IP地址是111.111.111.111 ”。于是，我们知道了对方的IP地址。（假设百度的IP地址是111.111.111.111）

#### 计算是否同一个子网络
我们这时候就要判断他的这个IP地址和我的IP地址是不是同一个子网络了，不是同一个子网络就要通过网关转发。比如我们的子网掩码是255.255.255.0，本机用它对自己的IP地址192.168.1.100，做一个二进制的AND运算（两个数位都为1，结果为1，否则为0），计算结果为192.168.1.0；然后对百度的IP地址111.111.111.111也做一个AND运算，计算结果为123.123.123.0。这两个结果不相等，所以结论是，百度与本机不在同一个子网络。因此，我们要向百度发送数据包，必须通过网关192.168.1.1转发，也就是说，接收方的MAC地址将是网关的MAC地址。

### TCP三次握手，发送HTTP包，TCP包，IP包等
在按下的那一瞬间名，浏览器建立一条与目标Web服务器的TCP连接（三次握手），发送一个HTTP请求，通过TCP协议，将HTTP请求的内容获取。也就是TCP数据包，加上嵌入HTTP的数据包。

TCP数据包再嵌入到IP数据包。IP数据包需要设置双方的IP地址，这是已知的，发送方是192.168.1.100（本机），接收方是111.111.111.111（百度）。然后IP数据包里头加上嵌入的TCP数据包

IP数据包嵌入以太网数据包。以太网数据包需要设置双方的MAC地址，发送方为本机的网卡MAC地址，接收方为网关192.168.1.1的MAC地址（通过ARP协议得到)

### 网关发挥作用，流弊啊，老铁
经过多个网关的转发，百度的服务器111.111.111.111，收到了这四个以太网数据包。根据IP标头的序号，百度将四个包拼起来，取出完整的TCP数据包，然后读出里面的"HTTP请求"，接着做出"HTTP响应"，再用TCP协议发回来。本机收到HTTP响应以后，就可以将网页显示出来，完成一次网络通信。

### 关闭连接，浏览器解析文档

### 如果文档中有资源，重复前三条动作，一直到资源全部加载完毕

## 相关链接
个人简历 : http://www.pengdaokuan.cn

个人博客 : http://blog.pengdaokuan.cn:4001

